#!/usr/bin/env node
const Program = require('commander')
const inquirer = require('inquirer')
const logger = require('../src/lib/logger')
const { isProjectName, isAppId } = require('../src/lib/validate')
const init = require('../src/scripts/init')

const Prompt = inquirer.createPromptModule()

const initPrompt = [
  {
    type: 'input',
    name: 'projectName',
    message: 'Please enter a project name',
    validate(input) {
      if (!isProjectName(input)) {
        return 'Invalid project name'
      }
      return true
    },
  },
  {
    type: 'input',
    name: 'projectDescription',
    message: 'Please enter a project description',
    defualt: '',
  },
  {
    type: 'input',
    name: 'author',
    message: 'Please enter a name for author',
    defualt: '',
  },
  {
    type: 'input',
    name: 'appId',
    message: 'Please enter a wechat appId',
    validate(input) {
      if (!isAppId(input)) {
        return 'Invalid wechat appId'
      }
      return true
    },
  },
  {
    type: 'list',
    name: 'libVersion',
    message: 'Please choose base wechart libVersion',
    choices: ['2.15.0', '2.14.4', '2.14.3', '2.14.1', '2.14.0'],
    default: '2.14.0',
  },
  {
    type: 'list',
    name: 'componentLibrary',
    message: 'Please choose An Component Library',
    default: 'jpass',
    choices: ['jpass', 'vant-weapp'],
  },
  {
    type: 'list',
    name: 'cssPrecompiledType',
    message: 'Please choose An Css Precompiled Type',
    default: 'Sass',
    choices: ['Sass', 'Less'],
  },
  {
    type: 'confirm',
    name: 'esLint',
    message: 'Use ESLint to lint your code?',
    default: true,
  },
  {
    type: 'confirm',
    name: 'isOk',
    message: 'Is this OK?',
    default: true,
  },
]

Program.name('mp init').action(() => {
  Prompt(initPrompt)
    .then((answer) => {
      if (answer.isOk) {
        init(answer)
      } else {
        logger.error('you canceled the operation, please try again')
      }
    })
    .catch((error) => {
      console.log(error)
      logger.error('init error, please try again')
    })
})

Program.parse(process.argv)
